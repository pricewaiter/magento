<VirtualHost *:80>
  DocumentRoot %TRAVIS_BUILD_DIR%
  ServerName %VIRTUALHOST_NAME%
  LogLevel debug
  DirectoryIndex index.php

  <Directory "%TRAVIS_BUILD_DIR%">
    AllowOverride All
    Options -MultiViews FollowSymLinks ExecCGI
    Order allow,deny
    Allow from all
  </Directory>

  # Wire up Apache to use Travis CI's php-fpm.
  <IfModule mod_fastcgi.c>
    AddHandler php5-fcgi .php
    Action php5-fcgi /php5-fcgi
    Alias /php5-fcgi /usr/lib/cgi-bin/php5-fcgi
    FastCgiExternalServer /usr/lib/cgi-bin/php5-fcgi -host 127.0.0.1:9000 -pass-header Authorization
  </IfModule>

  # Magento configuration
  <IfModule mod_ssl.c>
    SSLOptions StdEnvVars
  </IfModule>

  <IfModule mod_rewrite.c>
    RewriteEngine on
    RewriteBase /
    RewriteRule ^api/rest api.php?type=rest [QSA,L]
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
    RewriteCond %{REQUEST_METHOD} ^TRAC[EK]
    RewriteRule .* - [L,R=405]
    RewriteCond %{REQUEST_URI} !^/(media|skin|js)/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-l
    RewriteRule .* index.php [L]
  </IfModule>

  <Files RELEASE_NOTES.txt>
    order allow,deny
    deny from all
  </Files>

  AddDefaultCharset Off

  <IfModule mod_expires.c>
    ExpiresDefault "access plus 1 year"
  </IfModule>

</VirtualHost>
